/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
import * as fs from 'fs';
import * as path from 'path';
import ts from 'typescript';
/** Comment that can be used to skip a single import from being flagged. */
const skipComment = '// @ng_package: ignore-cross-repo-import';
/**
 * Analyzes the given JavaScript source file and checks whether there are
 * any relative imports that point to different entry-points or packages.
 *
 * Such imports are flagged and will be returned in the failure list. Cross
 * entry-point or package imports result in duplicate code and therefore are
 * forbidden (unless explicitly opted out via comment - {@link skipComment}).
 */
export function analyzeFileAndEnsureNoCrossImports(file, pkg) {
    const content = fs.readFileSync(file.path, 'utf8');
    const sf = ts.createSourceFile(file.path, content, ts.ScriptTarget.Latest, true);
    const fileDirPath = path.posix.dirname(file.path);
    const fileDebugName = file.shortPath.replace(/\.[cm]js$/, '.ts');
    const failures = [];
    const owningPkg = determineOwningEntryPoint(file, pkg);
    if (owningPkg === null) {
        throw new Error(`Could not determine owning entry-point package of: ${file.shortPath}`);
    }
    // TODO: Consider handling deep dynamic import expressions.
    for (const st of sf.statements) {
        if (!ts.isImportDeclaration(st) || !ts.isStringLiteralLike(st.moduleSpecifier)) {
            continue;
        }
        // Skip module imports.
        if (!st.moduleSpecifier.text.startsWith('.')) {
            continue;
        }
        // Skip this import if there is an explicit skip comment.
        const leadingComments = ts.getLeadingCommentRanges(sf.text, st.getFullStart());
        if (leadingComments !== undefined &&
            leadingComments.some((c) => sf.text.substring(c.pos, c.end) === skipComment)) {
            continue;
        }
        const destinationPath = path.posix.join(fileDirPath, st.moduleSpecifier.text);
        const targetPackage = determineOwningEntryPoint({ path: destinationPath }, pkg);
        if (targetPackage === null) {
            failures.push(`Could not determine owning entry-point package of: ${destinationPath}. Imported from: ${fileDebugName}. Is this a relative import to another full package?.\n` +
                `You can skip this import by adding a comment: ${skipComment}`);
            continue;
        }
        if (targetPackage.path !== owningPkg.path) {
            failures.push(`Found relative cross entry-point import in: ${fileDebugName}. Import to: ${st.moduleSpecifier.text}\n` +
                `You can skip this import by adding a comment: ${skipComment}`);
        }
    }
    return failures;
}
/** Determines the owning entry-point for the given JavaScript file. */
function determineOwningEntryPoint(file, pkg) {
    let owningEntryPoint = null;
    for (const [name, info] of Object.entries(pkg.entryPoints)) {
        // Entry point directory is assumed because technically the entry-point
        // could be deeper inside the entry-point source file package. This is
        // unlikely though and we still catch most cases, especially in the standard
        // folder layout where the APF entry-point index file resides at the top of
        // the entry-point.
        const assumedEntryPointDir = path.posix.dirname(info.index.path);
        if (file.path.startsWith(assumedEntryPointDir) &&
            (owningEntryPoint === null || owningEntryPoint.path.length < assumedEntryPointDir.length)) {
            owningEntryPoint = { name, info, path: assumedEntryPointDir };
        }
    }
    return owningEntryPoint;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3Jvc3NfZW50cnlfcG9pbnRzX2ltcG9ydHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wYWNrYWdlcy9iYXplbC9zcmMvbmdfcGFja2FnZS9jcm9zc19lbnRyeV9wb2ludHNfaW1wb3J0cy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0dBTUc7QUFFSCxPQUFPLEtBQUssRUFBRSxNQUFNLElBQUksQ0FBQztBQUN6QixPQUFPLEtBQUssSUFBSSxNQUFNLE1BQU0sQ0FBQztBQUM3QixPQUFPLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFjNUIsMkVBQTJFO0FBQzNFLE1BQU0sV0FBVyxHQUFHLDBDQUEwQyxDQUFDO0FBRS9EOzs7Ozs7O0dBT0c7QUFDSCxNQUFNLFVBQVUsa0NBQWtDLENBQ2hELElBQW1CLEVBQ25CLEdBQW9CO0lBRXBCLE1BQU0sT0FBTyxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNuRCxNQUFNLEVBQUUsR0FBRyxFQUFFLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxPQUFPLEVBQUUsRUFBRSxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDakYsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2xELE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFdBQVcsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUNqRSxNQUFNLFFBQVEsR0FBYSxFQUFFLENBQUM7SUFFOUIsTUFBTSxTQUFTLEdBQUcseUJBQXlCLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3ZELElBQUksU0FBUyxLQUFLLElBQUksRUFBRSxDQUFDO1FBQ3ZCLE1BQU0sSUFBSSxL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LENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgR29vZ2xlIExMQyBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzIGdvdmVybmVkIGJ5IGFuIE1JVC1zdHlsZSBsaWNlbnNlIHRoYXQgY2FuIGJlXG4gKiBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlIGF0IGh0dHBzOi8vYW5ndWxhci5pby9saWNlbnNlXG4gKi9cblxuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB0cyBmcm9tICd0eXBlc2NyaXB0JztcblxuaW1wb3J0IHtCYXplbEZpbGVJbmZvLCBFbnRyeVBvaW50SW5mbywgUGFja2FnZU1ldGFkYXRhfSBmcm9tICcuL2FwaSc7XG5cbi8qKiBJbnRlcmZhY2UgZGVzY3JpYmluZyBhbiBlbnRyeS1wb2ludCBCYXplbCBwYWNrYWdlLiAqL1xuaW50ZXJmYWNlIEVudHJ5UG9pbnRQYWNrYWdlIHtcbiAgLyoqIE1vZHVsZSBuYW1lIG9mIHRoZSBlbnRyeS1wb2ludC4gKi9cbiAgbmFtZTogc3RyaW5nO1xuICAvKiogRXhlY3Jvb3QtcmVsYXRpdmUgcGF0aCB0byB0aGUgZW50cnktcG9pbnQgcGFja2FnZS4gKi9cbiAgcGF0aDogc3RyaW5nO1xuICAvKiogRXh0cmFjdGVkIGluZm8gZm9yIHRoZSBlbnRyeS1wb2ludC4gKi9cbiAgaW5mbzogRW50cnlQb2ludEluZm87XG59XG5cbi8qKiBDb21tZW50IHRoYXQgY2FuIGJlIHVzZWQgdG8gc2tpcCBhIHNpbmdsZSBpbXBvcnQgZnJvbSBiZWluZyBmbGFnZ2VkLiAqL1xuY29uc3Qgc2tpcENvbW1lbnQgPSAnLy8gQG5nX3BhY2thZ2U6IGlnbm9yZS1jcm9zcy1yZXBvLWltcG9ydCc7XG5cbi8qKlxuICogQW5hbHl6ZXMgdGhlIGdpdmVuIEphdmFTY3JpcHQgc291cmNlIGZpbGUgYW5kIGNoZWNrcyB3aGV0aGVyIHRoZXJlIGFyZVxuICogYW55IHJlbGF0aXZlIGltcG9ydHMgdGhhdCBwb2ludCB0byBkaWZmZXJlbnQgZW50cnktcG9pbnRzIG9yIHBhY2thZ2VzLlxuICpcbiAqIFN1Y2ggaW1wb3J0cyBhcmUgZmxhZ2dlZCBhbmQgd2lsbCBiZSByZXR1cm5lZCBpbiB0aGUgZmFpbHVyZSBsaXN0LiBDcm9zc1xuICogZW50cnktcG9pbnQgb3IgcGFja2FnZSBpbXBvcnRzIHJlc3VsdCBpbiBkdXBsaWNhdGUgY29kZSBhbmQgdGhlcmVmb3JlIGFyZVxuICogZm9yYmlkZGVuICh1bmxlc3MgZXhwbGljaXRseSBvcHRlZCBvdXQgdmlhIGNvbW1lbnQgLSB7QGxpbmsgc2tpcENvbW1lbnR9KS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFuYWx5emVGaWxlQW5kRW5zdXJlTm9Dcm9zc0ltcG9ydHMoXG4gIGZpbGU6IEJhemVsRmlsZUluZm8sXG4gIHBrZzogUGFja2FnZU1ldGFkYXRhLFxuKTogc3RyaW5nW10ge1xuICBjb25zdCBjb250ZW50ID0gZnMucmVhZEZpbGVTeW5jKGZpbGUucGF0aCwgJ3V0ZjgnKTtcbiAgY29uc3Qgc2YgPSB0cy5jcmVhdGVTb3VyY2VGaWxlKGZpbGUucGF0aCwgY29udGVudCwgdHMuU2NyaXB0VGFyZ2V0LkxhdGVzdCwgdHJ1ZSk7XG4gIGNvbnN0IGZpbGVEaXJQYXRoID0gcGF0aC5wb3NpeC5kaXJuYW1lKGZpbGUucGF0aCk7XG4gIGNvbnN0IGZpbGVEZWJ1Z05hbWUgPSBmaWxlLnNob3J0UGF0aC5yZXBsYWNlKC9cXC5bY21danMkLywgJy50cycpO1xuICBjb25zdCBmYWlsdXJlczogc3RyaW5nW10gPSBbXTtcblxuICBjb25zdCBvd25pbmdQa2cgPSBkZXRlcm1pbmVPd25pbmdFbnRyeVBvaW50KGZpbGUsIHBrZyk7XG4gIGlmIChvd25pbmdQa2cgPT09IG51bGwpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENvdWxkIG5vdCBkZXRlcm1pbmUgb3duaW5nIGVudHJ5LXBvaW50IHBhY2thZ2Ugb2Y6ICR7ZmlsZS5zaG9ydFBhdGh9YCk7XG4gIH1cblxuICAvLyBUT0RPOiBDb25zaWRlciBoYW5kbGluZyBkZWVwIGR5bmFtaWMgaW1wb3J0IGV4cHJlc3Npb25zLlxuICBmb3IgKGNvbnN0IHN0IG9mIHNmLnN0YXRlbWVudHMpIHtcbiAgICBpZiAoIXRzLmlzSW1wb3J0RGVjbGFyYXRpb24oc3QpIHx8ICF0cy5pc1N0cmluZ0xpdGVyYWxMaWtlKHN0Lm1vZHVsZVNwZWNpZmllcikpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICAvLyBTa2lwIG1vZHVsZSBpbXBvcnRzLlxuICAgIGlmICghc3QubW9kdWxlU3BlY2lmaWVyLnRleHQuc3RhcnRzV2l0aCgnLicpKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgLy8gU2tpcCB0aGlzIGltcG9ydCBpZiB0aGVyZSBpcyBhbiBleHBsaWNpdCBza2lwIGNvbW1lbnQuXG4gICAgY29uc3QgbGVhZGluZ0NvbW1lbnRzID0gdHMuZ2V0TGVhZGluZ0NvbW1lbnRSYW5nZXMoc2YudGV4dCwgc3QuZ2V0RnVsbFN0YXJ0KCkpO1xuICAgIGlmIChcbiAgICAgIGxlYWRpbmdDb21tZW50cyAhPT0gdW5kZWZpbmVkICYmXG4gICAgICBsZWFkaW5nQ29tbWVudHMuc29tZSgoYykgPT4gc2YudGV4dC5zdWJzdHJpbmcoYy5wb3MsIGMuZW5kKSA9PT0gc2tpcENvbW1lbnQpXG4gICAgKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBjb25zdCBkZXN0aW5hdGlvblBhdGggPSBwYXRoLnBvc2l4LmpvaW4oZmlsZURpclBhdGgsIHN0Lm1vZHVsZVNwZWNpZmllci50ZXh0KTtcbiAgICBjb25zdCB0YXJnZXRQYWNrYWdlID0gZGV0ZXJtaW5lT3duaW5nRW50cnlQb2ludCh7cGF0aDogZGVzdGluYXRpb25QYXRofSwgcGtnKTtcbiAgICBpZiAodGFyZ2V0UGFja2FnZSA9PT0gbnVsbCkge1xuICAgICAgZmFpbHVyZXMucHVzaChcbiAgICAgICAgYENvdWxkIG5vdCBkZXRlcm1pbmUgb3duaW5nIGVudHJ5LXBvaW50IHBhY2thZ2Ugb2Y6ICR7ZGVzdGluYXRpb25QYXRofS4gSW1wb3J0ZWQgZnJvbTogJHtmaWxlRGVidWdOYW1lfS4gSXMgdGhpcyBhIHJlbGF0aXZlIGltcG9ydCB0byBhbm90aGVyIGZ1bGwgcGFja2FnZT8uXFxuYCArXG4gICAgICAgICAgYFlvdSBjYW4gc2tpcCB0aGlzIGltcG9ydCBieSBhZGRpbmcgYSBjb21tZW50OiAke3NraXBDb21tZW50fWAsXG4gICAgICApO1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgaWYgKHRhcmdldFBhY2thZ2UucGF0aCAhPT0gb3duaW5nUGtnLnBhdGgpIHtcbiAgICAgIGZhaWx1cmVzLnB1c2goXG4gICAgICAgIGBGb3VuZCByZWxhdGl2ZSBjcm9zcyBlbnRyeS1wb2ludCBpbXBvcnQgaW46ICR7ZmlsZURlYnVnTmFtZX0uIEltcG9ydCB0bzogJHtzdC5tb2R1bGVTcGVjaWZpZXIudGV4dH1cXG5gICtcbiAgICAgICAgICBgWW91IGNhbiBza2lwIHRoaXMgaW1wb3J0IGJ5IGFkZGluZyBhIGNvbW1lbnQ6ICR7c2tpcENvbW1lbnR9YCxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGZhaWx1cmVzO1xufVxuXG4vKiogRGV0ZXJtaW5lcyB0aGUgb3duaW5nIGVudHJ5LXBvaW50IGZvciB0aGUgZ2l2ZW4gSmF2YVNjcmlwdCBmaWxlLiAqL1xuZnVuY3Rpb24gZGV0ZXJtaW5lT3duaW5nRW50cnlQb2ludChcbiAgZmlsZTogUGljazxCYXplbEZpbGVJbmZvLCAncGF0aCc+LFxuICBwa2c6IFBhY2thZ2VNZXRhZGF0YSxcbik6IEVudHJ5UG9pbnRQYWNrYWdlIHwgbnVsbCB7XG4gIGxldCBvd25pbmdFbnRyeVBvaW50OiBFbnRyeVBvaW50UGFja2FnZSB8IG51bGwgPSBudWxsO1xuXG4gIGZvciAoY29uc3QgW25hbWUsIGluZm9dIG9mIE9iamVjdC5lbnRyaWVzKHBrZy5lbnRyeVBvaW50cykpIHtcbiAgICAvLyBFbnRyeSBwb2ludCBkaXJlY3RvcnkgaXMgYXNzdW1lZCBiZWNhdXNlIHRlY2huaWNhbGx5IHRoZSBlbnRyeS1wb2ludFxuICAgIC8vIGNvdWxkIGJlIGRlZXBlciBpbnNpZGUgdGhlIGVudHJ5LXBvaW50IHNvdXJjZSBmaWxlIHBhY2thZ2UuIFRoaXMgaXNcbiAgICAvLyB1bmxpa2VseSB0aG91Z2ggYW5kIHdlIHN0aWxsIGNhdGNoIG1vc3QgY2FzZXMsIGVzcGVjaWFsbHkgaW4gdGhlIHN0YW5kYXJkXG4gICAgLy8gZm9sZGVyIGxheW91dCB3aGVyZSB0aGUgQVBGIGVudHJ5LXBvaW50IGluZGV4IGZpbGUgcmVzaWRlcyBhdCB0aGUgdG9wIG9mXG4gICAgLy8gdGhlIGVudHJ5LXBvaW50LlxuICAgIGNvbnN0IGFzc3VtZWRFbnRyeVBvaW50RGlyID0gcGF0aC5wb3NpeC5kaXJuYW1lKGluZm8uaW5kZXgucGF0aCk7XG5cbiAgICBpZiAoXG4gICAgICBmaWxlLnBhdGguc3RhcnRzV2l0aChhc3N1bWVkRW50cnlQb2ludERpcikgJiZcbiAgICAgIChvd25pbmdFbnRyeVBvaW50ID09PSBudWxsIHx8IG93bmluZ0VudHJ5UG9pbnQucGF0aC5sZW5ndGggPCBhc3N1bWVkRW50cnlQb2ludERpci5sZW5ndGgpXG4gICAgKSB7XG4gICAgICBvd25pbmdFbnRyeVBvaW50ID0ge25hbWUsIGluZm8sIHBhdGg6IGFzc3VtZWRFbnRyeVBvaW50RGlyfTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gb3duaW5nRW50cnlQb2ludDtcbn1cbiJdfQ==